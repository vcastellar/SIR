% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/simulate_epi.R
\name{simulate_epi}
\alias{simulate_epi}
\title{Simulate an epidemic model defined by an \code{epi_model} object}
\usage{
simulate_epi(
  model,
  n_days = 200,
  parms = NULL,
  init = NULL,
  init_args = list(N = 1e+06, I0 = 10, R0 = 0),
  times = NULL,
  rho = 1,
  obs = c("negbin", "poisson", "none"),
  size = 20,
  seed = NULL,
  method = "lsoda"
)
}
\arguments{
\item{model}{An object of class \code{"epi_model"} defining the epidemic model
to simulate (e.g. SIR, SIRS).}

\item{n_days}{Integer. Number of days to simulate. Ignored if \code{times} is
provided.}

\item{parms}{Named numeric vector of model parameters. Must match
\code{model$par_names}. Any missing parameters are taken from
\code{model$defaults}, if available.}

\item{init}{Named numeric vector with initial state values. If \code{NULL}
(default), the function uses \code{model$make_init} together with
\code{init_args}.}

\item{init_args}{Named list of arguments passed to \code{model$make_init} to
construct the initial state (e.g. \code{N}, \code{I0}, \code{R0}).}

\item{times}{Optional numeric vector of time points at which to solve the ODE
system. If supplied, it overrides \code{n_days}.}

\item{rho}{Numeric in \eqn{[0,1]}. Reporting fraction mapping true incidence to
expected observed incidence.}

\item{obs}{Character string specifying the observation model. One of
\code{"poisson"}, \code{"negbin"}, or \code{"none"}.}

\item{size}{Numeric. Dispersion (size) parameter for the negative binomial
observation model. Larger values imply less overdispersion.}

\item{seed}{Optional integer. If provided, sets the random seed for reproducible
observation draws.}

\item{method}{Character string. Integration method passed to
\code{deSolve::ode()} (default: \code{"lsoda"}).}
}
\value{
A named list with the following components:
\describe{
\item{model}{Name of the epidemic model.}
\item{params}{List of model parameters used in the simulation.}
\item{states}{Data frame with columns \code{time} and the model state
variables (e.g. \code{S}, \code{I}, \code{R}, \code{C}).}
\item{incidence_true}{Data frame with columns \code{time} and \code{inc}
containing the latent model incidence.}
\item{incidence_obs}{Data frame with columns \code{time} and \code{inc}
containing the observed (reported) incidence counts.}
\item{cumulative_obs}{Data frame with columns \code{time} and
\code{cases_cum} containing cumulative observed cases.}
}
}
\description{
Simulates a deterministic compartmental epidemic model (e.g. SIR, SIRS, or any
user-defined extension) specified via an \code{epi_model} object. The model is
solved as an ODE system using \code{deSolve::ode()}, and can optionally include
an observation process to generate reported incidence counts.

The function is model-agnostic: all model-specific information (state variables,
parameters, ODE right-hand side, bounds, and output conventions) is read from
the supplied \code{epi_model}.
}
\details{
\subsection{Model structure}{

The \code{model} argument must be an object of class \code{"epi_model"}, typically
created with \code{new_epi_model()}. At minimum, the model must define:
\itemize{
\item a right-hand side ODE function (\code{model$rhs});
\item the required state variables (\code{model$state_names});
\item the model parameters (\code{model$par_names}).
}

Optionally, the model may also define:
\itemize{
\item default parameter values (\code{model$defaults});
\item parameter bounds (\code{model$lower}, \code{model$upper});
\item a helper function to construct initial conditions
(\code{model$make_init});
\item standard output column names for incidence and cumulative infections
(\code{model$output}).
}
}

\subsection{Time grid}{

By default, the model is simulated on a daily grid from day 0 to
\code{n_days}. Alternatively, a custom numeric vector of times can be supplied
via \code{times}.
}

\subsection{Observation model}{

The latent incidence produced by the ODE model can be converted into reported
incidence counts using a simple observation model:
\describe{
\item{\code{obs = "poisson"}}{Reported counts are drawn from a Poisson
distribution with mean \eqn{\mu(t) = \rho \lambda(t)}.}
\item{\code{obs = "negbin"}}{Reported counts are drawn from a negative binomial
distribution with mean \eqn{\mu(t) = \rho \lambda(t)} and dispersion
parameter \code{size}.}
\item{\code{obs = "none"}}{No observation process is applied; observed
incidence and cumulative counts are returned as \code{NA}.}
}
}
}
\examples{
## SIR simulation
sim <- simulate_epi(
  model = SIR_MODEL,
  n_days = 200,
  parms = c(beta = 0.30, gamma = 0.10),
  init_args = list(N = 1e6, I0 = 20, R0 = 0),
  rho = 0.3,
  obs = "poisson",
  seed = 1
)

plot(sim)

## SIRS simulation
sim2 <- simulate_epi(
  model = SIRS_MODEL,
  n_days = 200,
  parms = c(beta = 0.30, gamma = 0.10, omega = 0.02),
  init_args = list(N = 1e6, I0 = 20, R0 = 0),
  obs = "none"
)
plot(sim2)

}
\seealso{
\code{\link{new_epi_model}}, \code{\link{deSolve::ode}}
}
