% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/simulate_epi.R
\name{simulate_epi}
\alias{simulate_epi}
\title{Simulate an epidemic model (SIR or SIRS) and generate observed incidence}
\usage{
simulate_epi(
  n_days = 200,
  model = c("sir", "sirs"),
  N = 1e+06,
  beta = 0.35,
  gamma = 0.1,
  omega = 0,
  I0 = 10,
  R0 = 0,
  rho = 1,
  obs = c("negbin", "poisson"),
  size = 20,
  seed = NULL
)
}
\arguments{
\item{n_days}{Integer. Number of days to simulate (output will include day 0 to
day \code{n_days}).}

\item{model}{Character. Epidemic model to simulate. One of \code{"sir"} or
\code{"sirs"}.}

\item{N}{Numeric. Total population size.}

\item{beta}{Numeric. Transmission rate (per day).}

\item{gamma}{Numeric. Recovery/removal rate (per day).}

\item{omega}{Numeric. Loss-of-immunity rate (per day). Only used when
\code{model = "sirs"}. Setting \eqn{\omega = 0} recovers SIR-like behavior.}

\item{I0}{Numeric. Initial number of infectious individuals at day 0.}

\item{R0}{Numeric. Initial number of removed/recovered individuals at day 0.}

\item{rho}{Numeric in \eqn{[0, 1]}. Reporting fraction mapping true incidence to
expected observed cases.}

\item{obs}{Character. Observation model for reported incidence. Either
\code{"poisson"} or \code{"negbin"}.}

\item{size}{Numeric. Dispersion (size) parameter for the negative binomial
observation model. Larger values imply less overdispersion.}

\item{seed}{Optional integer. If provided, sets the random seed for reproducible
observation draws.}
}
\value{
A named list with:
\describe{
\item{params}{A list with the simulation parameters used (including \code{model}).}
\item{states}{A data frame with columns \code{time}, \code{S}, \code{I},
\code{R}, and \code{C} (cumulative infection events).}
\item{incidence_true}{A data frame with columns \code{time} and \code{inc}
(latent incidence \eqn{\lambda(t)}).}
\item{incidence_obs}{A data frame with columns \code{time} and \code{inc}
(reported incidence sampled from the observation model).}
\item{cumulative_obs}{A data frame with columns \code{time} and
\code{cases_cum} (cumulative reported cases).}
}
}
\description{
Simulates a deterministic compartmental epidemic model solved as an ODE system
(via \code{deSolve::ode()}) and produces both the latent epidemic trajectories
and a simple observation process for reported cases.

The function supports \strong{SIR} and \strong{SIRS} dynamics, selected via
the \code{model} argument. The model is extended with an auxiliary compartment
\eqn{C(t)} that tracks the cumulative number of \emph{infection events} through
the incidence \eqn{\lambda(t)}.
}
\details{
\subsection{Models}{

Let \eqn{N = S(t) + I(t) + R(t)} and define the incidence (new infections per day):
\deqn{\lambda(t) = \beta \frac{S(t) I(t)}{N}}
\subsection{SIR (\code{model = "sir"})}{

\deqn{
\begin{aligned}
\frac{dS}{dt} &= -\lambda(t) \\
\frac{dI}{dt} &= \lambda(t) - \gamma I(t) \\
\frac{dR}{dt} &= \gamma I(t)
\end{aligned}
}
}

\subsection{SIRS (\code{model = "sirs"})}{

In SIRS, recovered individuals lose immunity at rate \eqn{\omega} and return to
the susceptible compartment:
\deqn{
\begin{aligned}
\frac{dS}{dt} &= -\lambda(t) + \omega R(t) \\
\frac{dI}{dt} &= \lambda(t) - \gamma I(t) \\
\frac{dR}{dt} &= \gamma I(t) - \omega R(t)
\end{aligned}
}
}

}

\subsection{Cumulative infections}{

To provide a cumulative infection curve, the model includes:
\deqn{\frac{dC}{dt} = \lambda(t)}
so that \eqn{C(t)} accumulates infection events over time (continuous-time
analogue of cumulative incidence). Under \code{model = "sirs"}, reinfections are
possible, so \eqn{C(t)} may exceed \eqn{N}.
}

\subsection{Observation model}{

The function converts the latent incidence \eqn{\lambda(t)} into expected reported
counts using a reporting fraction \eqn{\rho}:
\deqn{\mu(t) = \rho \lambda(t)}
and then samples:
\itemize{
\item \code{obs = "poisson"}: \eqn{Y(t) \sim \mathrm{Poisson}(\mu(t))}
\item \code{obs = "negbin"}: \eqn{Y(t) \sim \mathrm{NegBin}(\mu(t), size)}
}

The observed cumulative cases are computed as \code{cumsum(inc_obs)}.
}
}
\examples{
# SIR simulation
sim_sir <- simulate_epi(
  n_days = 300, model = "sir",
  N = 1e6, beta = 0.30, gamma = 0.10,
  I0 = 20, rho = 0.25, obs = "negbin", size = 15, seed = 1
)
plot(sim_sir)

# SIRS simulation (average immunity duration ~ 180 days)
sim_sirs <- simulate_epi(
  n_days = 600, model = "sirs",
  N = 1e6, beta = 0.30, gamma = 0.10, omega = 1/180,
  I0 = 20, rho = 0.25, obs = "poisson", seed = 1
)
plot(sim_sirs)
}
